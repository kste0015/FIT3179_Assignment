{
  "$schema":"https://vega.github.io/schema/vega-lite/v4.json",
  "title":"Volcano Explosivity Index of Volcano Types",
  "data":{
    "url":"https://raw.githubusercontent.com/kste0015/FIT3179_Assignment/main/data/eruptions.csv"
  },
  "transform":[
    {
      "filter":{
        "field":"vei",
        "valid":true
      }
    },
    {
      "lookup":"volcano_number",
      "from":{
        "data":{
          "url":"https://raw.githubusercontent.com/kste0015/FIT3179_Assignment/main/data/volcano.csv"
        },
        "key":"volcano_number",
        "fields":[
          "primary_volcano_type",
          "country",
          "region",
          "elevation",
          "population_within_5_km"
        ]
      }
    },
    {
      "filter":"datum.primary_volcano_type != null"
    },
    {
      "calculate":"replace(datum.primary_volcano_type,/\\?|\\(.*\\)$/,'')",
      "as":"VolcanoType"
    },
    {
      "aggregate":[
        {
          "op":"count",
          "as":"vei_type_count"
        }
      ],
      "groupby":[
        "vei",
        "VolcanoType"
      ]
    }
  ],
  "mark":"rect",
  "encoding":{
    "x":{
      "field":"VolcanoType",
      "type":"nominal",
      "title":"Volcano Type"
    },
    "y":{
      "field":"vei",
      "type":"ordinal",
      "sort":"-y",
      "title":"Volcano Explosivity Index"
    },
    "color":{
      "field":"vei_type_count",
      "type":"quantitative",
      "scale":{
        "type":"log",
        "scheme":"reds"
      },
      "title":"Eruption Count"
    },
    "tooltip":[
      {
        "field":"vei_type_count",
        "type":"quantitative",
        "title":"Eruption Count"
      },
      {
        "field":"VolcanoType",
        "type":"nominal",
        "title":"Volcano Type"
      },
      {
        "field":"vei",
        "type":"ordinal",
        "title":"Volcano Explosivity Index"
      }
    ]
  },
  "config":{
    "axis":{
      "grid":true,
      "tickBand":"extent"
    }
  }
}
